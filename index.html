<script>
        const PASSWORD = "SG2025";
        const DATA_URL = "./data/predictions.json"; 
        
        // --- BACKUP DATA (Ensures site never crashes) ---
        const BACKUP_DATA = [
            {
                "game": "Chiefs vs Bills",
                "sport": "NFL",
                "selection": "Chiefs -2.5",
                "confidence_tier": "STRONG",
                "analysis": "Mahomes at home in December is historically dominant against zone defense. The Bills secondary is banged up.",
                "timestamp": new Date().toISOString()
            },
            {
                "game": "Cowboys vs Eagles",
                "sport": "NFL",
                "selection": "Eagles -3.5",
                "confidence_tier": "LOCK",
                "analysis": "The Eagles pass rush should overwhelm the Cowboys O-line. Expect a low scoring game where Philly covers.",
                "timestamp": new Date().toISOString()
            },
            {
                "game": "Lakers vs Warriors",
                "sport": "NBA",
                "selection": "Over 235.5",
                "confidence_tier": "MEDIUM",
                "analysis": "Both teams are pushing the pace top 5 in the league. Curry and LeBron usually trade buckets in these matchups.",
                "timestamp": new Date().toISOString()
            },
            {
                "game": "Alabama vs Georgia",
                "sport": "CFB",
                "selection": "Georgia -6.5",
                "confidence_tier": "LEAN",
                "analysis": "Georgia's defense is allowing fewer than 10 points per game at home. Alabama struggles on the road.",
                "timestamp": new Date().toISOString()
            }
        ];

        let allPredictions = [];
        let currentLeague = "ALL";
        let currentConfidence = "ALL"; 
        
        function checkPassword() {
            if (document.getElementById('passwordInput').value === PASSWORD) {
                document.cookie = "sg_auth=true; max-age=604800; path=/"; 
                initApp();
            } else {
                document.getElementById('passwordError').style.display = 'block';
            }
        }

        function initApp() {
            document.getElementById('passwordOverlay').classList.add('hidden');
            document.getElementById('mainContent').classList.add('visible');
            fetchData(); 
        }

        async function fetchData() {
            const container = document.getElementById('predictionsContainer');
            const statusElement = document.getElementById('lastUpdated');
            container.innerHTML = '<div style="text-align:center; padding:4rem; color:white;"><h2>Loading Engine...</h2></div>'; 

            try {
                // Attempt to fetch real data
                const response = await fetch(`${DATA_URL}?t=${Date.now()}`);
                if (!response.ok) throw new Error("File not found");
                const data = await response.json();
                
                if (data && data.length > 0) {
                    allPredictions = data.filter(p => p.status !== "ARCHIVED").reverse();
                    statusElement.innerText = `Feed Synced: ${new Date().toLocaleTimeString()}`;
                } else {
                    throw new Error("Empty Data");
                }
            } catch (error) {
                // --- THE FIX: Load Backup Data instead of Erroring ---
                console.warn("Feed failed, loading backup data.");
                allPredictions = BACKUP_DATA;
                statusElement.innerText = 'Demo Mode (Offline)';
            }
            
            // Render whatever data we have
            applyFilters();
        }
        
        function renderCards(items) {
            const container = document.getElementById('predictionsContainer');
            container.innerHTML = "";
            
            if (items.length === 0) {
                document.getElementById('noData').classList.remove('hidden');
                return;
            }
            document.getElementById('noData').classList.add('hidden');

            items.forEach((pred, index) => {
                const selection = pred.selection || "N/A";
                const confidence = (pred.confidence_tier || "PASS").toUpperCase();
                const sport = pred.sport || detectSportFallback(pred.game);
                const tierClass = getTierClass(confidence);

                const card = document.createElement('div');
                card.className = 'game-card';
                
                card.innerHTML = `
                    <div class="card-header">
                        <div>
                            <div class="game-meta">
                                <span class="sport-tag">${sport}</span>
                                <span>${formatDate(pred.timestamp)}</span>
                            </div>
                            <div class="matchup-title">${pred.game}</div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="bet-row best-bet">
                            <div class="bet-info">
                                <span class="bet-label">üèÜ SELECTION</span>
                                <span class="bet-value">${selection}</span>
                            </div>
                            <span class="confidence-badge ${tierClass}">${confidence}</span>
                        </div>

                        <button class="read-more-btn" onclick="openModal('${index}')">Read Analysis</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function openModal(index) {
            const item = allPredictions[index];
            if (!item) return;
            
            document.getElementById('modalTitle').innerText = item.game;
            document.getElementById('modalSport').innerText = item.sport || "Sports";
            
            const confidence = (item.confidence_tier || "PASS").toUpperCase();
            const badge = document.getElementById('modalBadge');
            badge.innerText = confidence;
            badge.className = `confidence-badge ${getTierClass(confidence)}`;
            
            let analysisText = item.analysis || "Analysis unavailable.";
            document.getElementById('modalBody').innerText = analysisText;
            document.getElementById('analysisModal').classList.add('active');
        }

        function closeModal(e) {
            if (e.target === document.getElementById('analysisModal') || e.target.classList.contains('modal-close')) {
                document.getElementById('analysisModal').classList.remove('active');
            }
        }

        function applyFilters() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            
            const filtered = allPredictions.filter(p => {
                const sport = p.sport || detectSportFallback(p.game);
                const conf = (p.confidence_tier || 'PASS').toUpperCase();
                
                const matchesLeague = currentLeague === "ALL" || sport === currentLeague;
                const matchesSearch = p.game.toLowerCase().includes(search);
                const matchesConfidence = currentConfidence === "ALL" || conf.includes(currentConfidence);
                
                return matchesLeague && matchesSearch && matchesConfidence;
            });
            renderCards(filtered);
        }

        function detectSportFallback(gameTitle) {
            if (!gameTitle) return "Sports";
            if (gameTitle.includes("Cowboys") || gameTitle.includes("Chiefs")) return "NFL";
            if (gameTitle.includes("Lakers") || gameTitle.includes("Warriors")) return "NBA";
            return "NFL"; 
        }

        function getTierClass(tier) {
            if (!tier) return "conf-pass";
            tier = tier.toUpperCase();
            if (tier.includes('LOCK')) return "conf-lock";
            if (tier.includes('STRONG')) return "conf-strong";
            if (tier.includes('MEDIUM')) return "conf-medium";
            if (tier.includes('LEAN')) return "conf-lean";
            return "conf-pass";
        }

        function formatDate(dateStr) {
            if (!dateStr) return "Today";
            try { return new Date(dateStr).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }); } 
            catch { return "Today"; }
        }

        function filterLeague(league, btnElement) {
            currentLeague = league;
            document.querySelectorAll('.league-menu .league-btn').forEach(btn => btn.classList.remove('active'));
            btnElement.classList.add('active');
            applyFilters();
        }

        function filterConfidence(tier, btnElement) {
            currentConfidence = tier;
            document.querySelectorAll('#confidenceFilterBar .filter-btn').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');
            applyFilters();
        }
        
        if (document.cookie.includes("sg_auth=true")) initApp();
    </script>
